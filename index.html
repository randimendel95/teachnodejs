<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Teaching node.js</title>
	<script src="https://code.jquery.com/jquery.min.js"></script>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
	<link rel="stylesheet" type="text/css" href="css/main.css">
</head>

<body class="container">
	<h1 class="pageTitle">Using Node.js</h1>

	<!--Teahing user to make a basic server, that does nothing with node.js-->
	<div>
		<h2>Create a basic http server</h2>
		<p>First off, we start by using the HTTP server</p>
		<p>In the file called "server.js", make an HTTP request to use the HTTP server with</p>
		<pre class="well well-md">
			<code class="startserver">
	var http = require("http");
			</code>
		</pre>
		<p>Once you have requested http, you have to create the server, and listen to it on a local host (eg. 8888) with </p>
		<pre class="well well-md">
			<code class="startserver">
	var server = http.createServer();
	server.listen(8888);
			</code>
		</pre>
		<p>This will start your file, and listen for commands on the local server 8888.  However, since we haven't made any requests yet, this command doesn't do anything.</p>
		<button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">View Code</button>

		<!-- Modal -->
		<div id="myModal" class="modal fade" role="dialog">
		  <div class="modal-dialog">

		    <!-- Modal content-->
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal">&times;</button>
		        <h4 class="modal-title">Running empty HTTP Server</h4>
		      </div>
		      <div class="modal-body">
		<pre class="well well-md">
			<code class="startserver">
	var http = require("http");

	var server = http.createServer();
	server.listen(8888);
			</code>
		</pre>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		      </div>
		    </div>

		  </div>
		</div>

		
	</div>

	<!--Writes onto the server using the response-->
	<div>
		<h2>Writing to the server</h2>
		<p>Now that we have a server running, we can add a function into the server, so that it will actually do something!  In our createServer() function, we now needs parameters for a request and a response.</p>
		<p>The <b>response</b> is what appears on our local server.</p>
		<p>Write to the response with the following </p>
		<pre class="well well-md">
			<code class="basichttp">
	response.writeHead(200, {"Content-Type": "text/plain"});
	response.write();
			</code>
		</pre>
		<p>Whatever you write inside the write() method will be written on the server.</p>
		<p>Now try adding to your "server.js" method by writing something to the page.  Now when you run the server with </p>
		<pre class="well well-md">
			<code class="basichttp">
	node server.js
			</code>
		</pre>
		<p>You should get that text on your localhost</p>

		<!-- Trigger the modal with a button -->
		<button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal2">View the Code</button>

		<!-- Modal -->
		<div id="myModal2" class="modal fade" role="dialog">
		  <div class="modal-dialog">

		    <!-- Modal content-->
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal">&times;</button>
		        <h4 class="modal-title">Running on a local Server</h4>
		      </div>
		      <div class="modal-body">
		<pre class="well well-md">
			<code class="basichttp">
	var http = require("http");

	http.createServer(function(request, response) {
	  	response.writeHead(200, {"Content-Type": "text/plain"});
	  	response.write("This will be posted on your server");
		response.end();
	}).listen(8888);
			</code>
		</pre>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		      </div>
		    </div>

		  </div>
		</div>


		<p>Now you are running an http server on your local host (8888).</p>
		<p>Now if you go to localhost:8888, it should be running your server, and writing whatever you put in the function response.write()!</p>
	</div>
	
	
	<!--Next we are showing the order of events and how asynchronous calls work-->
	<div>
		<h2>Asynchronous Calls with Node.js</h2>
		<p>This next section will show the order that node.js is processing requests, by printing to the console.  Using you server.js file, add in console.log() commands at the beginning of your function, and after the request.  For example:
		<pre class="well well-md">
			<code class="async">
	var http = require("http");
	function onRequest(request, response) {
		console.log("Request received.");
	  	response.writeHead(200, {"Content-Type": "text/plain"});
	  	response.write("This will be posted on your server");
	  	response.end();
	}
	http.createServer(onRequest).listen(8888);
	console.log("Server has started.");
			</code>
		</pre>
		<p>The expected order in the console based on how we've been running the server in this class would be : "Request received." in the console, followed by the request being written to the server, then finally "Server has started." in the console.  However, due to asynchronous calling, when the funcion is called, first the action is thrown into the event loop, then the server is started, and "Server has started." is shown on the console, then as node.js goes through the events, the request is received and then posted on the server.</p>

	<!--This next section shows how to use a router seperately-->
	<div>
		<h2>Routers</h2>
		<p>We can make the server.js file take care of the server, but run the calls on our index.js file.  In our index.js file, all we need is to verify that there is a server through the require function, and then call for action on that server.  We do this with the code:
		<pre class="well well-md">
			<code>
	var server = require("./server");
	server.start();
			</code>
		</pre>
		<p>This will call a function start() from the server file.  Our server should now look like this:
		<pre class="well well-md">
			<code>
	var http = require("http");

	function start() {
		function onRequest(request, response) {
	    	console.log("Request received.");
	    	response.writeHead(200, {"Content-Type": "text/plain"});
	    	response.write("Hello World");
	    	response.end();
	  	}
	  	http.createServer(onRequest).listen(8888);
	  	console.log("Server has started.");
	}
	exports.start = start;
			</code>
		</pre>
		<p>This calls our request function when start is called.  First it puts the onRequest function in the action loop, then outside of the onRequest function, it starts the server, then executes the action.  "exports.start = start" creates an empty object "exports" then sets it to the return of the start function. </p>  		
	</div>

	</body>
</html>

