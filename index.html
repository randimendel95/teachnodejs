<!DOCTYPE html>
<html>
<head>
	<title>Teaching node.js</title>
	<link rel="stylesheet" type="text/css" href="css/main.css">
</head>

<body>
	<h1 class="pageTitle">Using Node.js</h1>

	<!--Teahing user to make a basic server, that does nothing with node.js-->
	<div>
		<h2 class="">Create a basic http server</h2>
		<p>In your file server.js:

		<pre class="well well-md">
			<code class="startserver">
	var http = require("http");

	var server = http.createServer();
	server.listen(8888);
			</code>
		</pre>
		<p>This will start your file, and listen for commands on the local server 8888.</p>
	</div>

	<!--Writes onto the server using the response-->
	<div>
		<pre class="well well-md">
			<code class="basichttp">
	var http = require("http");

	http.createServer(function(request, response) {
	  	response.writeHead(200, {"Content-Type": "text/plain"});
	  	response.write("This will be posted on your server");
		response.end();
	}).listen(8888);
			</code>
		</pre>

		<p>Now you are running an http server on your local host (8888).</p>
		<p>To test this, go to your terminal and input the command</p>
		<pre class="well well-md">
			<code class="runserver">
	node server.js
			</code>
		</pre>
		<p>Now if you go to localhost:8888, it should be running your server, and writing whatever you put in the function response.write()!</p>
	</div>
	
	<!--Next we are showing the order of events and how asynchronous calls work-->
	<div>
		<h2>Asynchronous Calls with Node.js</h2>
		<p>This next section will show the order that node.js is processing requests, by printing to the console.  Using you server.js file, add in console.log() commands at the beginning of your function, and after the request.  For example:
		<pre class="well well-md">
			<code class="async">
	var http = require("http");
	function onRequest(request, response) {
		console.log("Request received.");
	  	response.writeHead(200, {"Content-Type": "text/plain"});
	  	response.write("This will be posted on your server");
	  	response.end();
	}
	http.createServer(onRequest).listen(8888);
	console.log("Server has started.");
			</code>
		</pre>
		<p>The expected order in the console based on how we've been running the server in this class would be : "Request received." in the console, followed by the request being written to the server, then finally "Server has started." in the console.  However, due to asynchronous calling, when the funcion is called, first the action is thrown into the event loop, then the server is started, and "Server has started." is shown on the console, then as node.js goes through the events, the request is received and then posted on the server.</p>

	<!--This next section shows how to use a router seperately-->
	<div>
		<h2>Routers</h2>
		<p>We can make the server.js file take care of the server, but run the calls on our index.js file.  In our index.js file, all we need is to verify that there is a server through the require function, and then call for action on that server.  We do this with the code:
		<pre class="well well-md">
			<code>
	var server = require("./server");
	server.start();
			</code>
		</pre>
		<p>This will call a function start() from the server file.  Our server should now look like this:
		<pre class="well well-md">
			<code>
	var http = require("http");

	function start() {
		function onRequest(request, response) {
	    	console.log("Request received.");
	    	response.writeHead(200, {"Content-Type": "text/plain"});
	    	response.write("Hello World");
	    	response.end();
	  	}
	  	http.createServer(onRequest).listen(8888);
	  	console.log("Server has started.");
	}
	exports.start = start;
			</code>
		</pre>
		<p>This calls our request function when start is called.  First it puts the onRequest function in the action loop, then outside of the onRequest function, it starts the server, then executes the action.  "exports.start = start" creates an empty object "exports" then sets it to the return of the start function. </p>  		
	</div>

	</body>
</html>

